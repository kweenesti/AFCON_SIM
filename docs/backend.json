
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User Profile",
      "type": "object",
      "description": "Represents a user's public profile and role.",
      "properties": {
        "id": {
          "type": "string",
          "description": "The user's unique ID, matching their Auth UID."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "role": {
          "type": "string",
          "description": "The user's role in the application (e.g., 'admin', 'federation').",
          "enum": ["admin", "federation"]
        }
      },
      "required": ["id", "email", "role"]
    },
    "Federation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Federation",
      "type": "object",
      "description": "Represents a football federation participating in the tournament.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the federation."
        },
        "representativeName": {
          "type": "string",
          "description": "Name of the federation's representative."
        },
        "representativeEmail": {
          "type": "string",
          "description": "Email address of the federation's representative.",
          "format": "email"
        },
        "countryId": {
          "type": "string",
          "description": "Reference to Country. (Relationship: Federation 1:1 Country)"
        },
        "countryName": {
          "type": "string",
          "description": "Name of the country for the federation."
        },
        "managerName": {
          "type": "string",
          "description": "Name of the team's manager."
        }
      },
      "required": [
        "id",
        "representativeName",
        "representativeEmail",
        "countryId",
        "countryName",
        "managerName"
      ]
    },
    "Country": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Country",
      "type": "object",
      "description": "Represents an African country participating in the tournament.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the country."
        },
        "name": {
          "type": "string",
          "description": "Name of the country."
        },
        "flagUrl": {
          "type": "string",
          "description": "URL to the country's flag image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "flagUrl"
      ]
    },
    "Player": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Player",
      "type": "object",
      "description": "Represents a player in a team's squad.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the player."
        },
        "federationId": {
          "type": "string",
          "description": "Reference to Federation. (Relationship: Federation 1:N Player)"
        },
        "name": {
          "type": "string",
          "description": "Name of the player."
        },
        "naturalPosition": {
          "type": "string",
          "description": "The player's natural position (GK, DF, MD, AT)."
        },
        "gkRating": {
          "type": "number",
          "description": "Player's rating as a Goalkeeper (GK)."
        },
        "dfRating": {
          "type": "number",
          "description": "Player's rating as a Defender (DF)."
        },
        "mdRating": {
          "type": "number",
          "description": "Player's rating as a Midfielder (MD)."
        },
        "atRating": {
          "type": "number",
          "description": "Player's rating as an Attacker (AT)."
        },
        "isCaptain": {
          "type": "boolean",
          "description": "Indicates whether the player is the captain of the team."
        }
      },
      "required": [
        "id",
        "federationId",
        "name",
        "naturalPosition",
        "gkRating",
        "dfRating",
        "mdRating",
        "atRating",
        "isCaptain"
      ]
    },
    "Tournament": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tournament",
      "type": "object",
      "description": "Represents the state of a tournament.",
      "properties": {
        "id": { "type": "string" },
        "started": { "type": "boolean" },
        "teams": { "type": "array", "items": { "type": "string" } },
        "stage": { "type": "string", "enum": ["quarter-finals", "semi-finals", "final"] },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "started", "teams", "stage", "createdAt"]
    },
     "Match": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Match",
      "description": "Represents a single match between two teams in a tournament.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "tournamentId": { "type": "string", "description": "The ID of the tournament this match belongs to." },
        "stage": { "type": "string", "enum": ["quarter-finals", "semi-finals", "final"] },
        "homeTeamId": { "type": "string" },
        "awayTeamId": { "type": "string" },
        "homeTeamName": { "type": "string" },
        "awayTeamName": { "type": "string" },
        "homeScore": { "type": "number" },
        "awayScore": { "type": "number" },
        "winnerId": { "type": "string" },
        "played": { "type": "boolean", "default": false },
        "createdAt": { "type": "string", "format": "date-time" },
        "goals": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "playerName": { "type": "string" },
              "minute": { "type": "number" },
              "teamId": { "type": "string" }
            },
            "required": ["playerName", "minute", "teamId"]
          }
        }
      },
      "required": ["id", "tournamentId", "stage", "homeTeamId", "awayTeamId", "homeTeamName", "awayTeamName", "played", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data, including their role. Only the authenticated user can read their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching their Auth UID."
            }
          ]
        }
      },
      {
        "path": "/countries/{countryId}",
        "definition": {
          "entityName": "Country",
          "schema": {
            "$ref": "#/backend/entities/Country"
          },
          "description": "Stores country data. Accessible to all users.",
          "params": [
            {
              "name": "countryId",
              "description": "The unique identifier of the country."
            }
          ]
        }
      },
      {
        "path": "/federations/{federationId}",
        "definition": {
          "entityName": "Federation",
          "schema": {
            "$ref": "#/backend/entities/Federation"
          },
          "description": "Stores federation data. Only accessible to the authenticated user with matching federationId.",
          "params": [
            {
              "name": "federationId",
              "description": "The unique identifier of the federation."
            }
          ]
        }
      },
      {
        "path": "/federations/{federationId}/players/{playerId}",
        "definition": {
          "entityName": "Player",
          "schema": {
            "$ref": "#/backend/entities/Player"
          },
          "description": "Stores player data. Includes denormalized 'federationId' for authorization independence. Only accessible to the federation who owns the player.",
          "params": [
            {
              "name": "federationId",
              "description": "The unique identifier of the federation."
            },
            {
              "name": "playerId",
              "description": "The unique identifier of the player."
            }
          ]
        }
      },
      {
        "path": "/tournaments/{tournamentId}",
        "definition": {
          "entityName": "Tournament",
          "schema": {
            "$ref": "#/backend/entities/Tournament"
          },
          "description": "Stores tournament state. Only admins can create, and all users can read.",
          "params": [
            {
              "name": "tournamentId",
              "description": "The unique identifier of the tournament."
            }
          ]
        }
      },
      {
        "path": "/matches/{matchId}",
        "definition": {
          "entityName": "Match",
          "schema": { "$ref": "#/backend/entities/Match" },
          "description": "Stores data for a single match. Only admins can create/update, all users can read.",
          "params": [
            {
              "name": "matchId",
              "description": "The unique identifier for the match."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the African Nations Tournament Simulator, focusing on secure and scalable data management for federations, countries, and players. Key to this design is authorization independence, achieved through denormalization. The structure also segregates data based on access requirements and uses consistent access modeling patterns.\n\nCountries are stored in a top-level `/countries` collection. This is public data, so no specific authorization is required.\n\nUser profiles are stored in a top-level `/users` collection, with document IDs matching the user's authentication UID. This allows for easy lookup of user-specific data like roles.\n\nFederations, which represent the user accounts in this system, are stored in a `/federations` collection.  Since this represents private data, the documents will store the `id` of the authenticated user who created it.  Security rules can then ensure only the authenticated user can read/write to their own Federation document. This ensures that each federation's data is isolated and accessible only by the authorized representative.\n\nPlayers are stored in a subcollection `/federations/{federationId}/players`. This subcollection approach provides a clear hierarchical structure that reflects the relationship between federations and players. To maintain authorization independence and enable efficient querying, the `federationId` is denormalized into each `Player` document.  This eliminates the need for complex `get()` calls in security rules and enables atomic operations.\n\nTournaments are stored in a top-level `/tournaments` collection. Only users with an 'admin' role can create tournaments, but all users can read them to see the tournament status.\n\nMatches are stored in a top-level `/matches` collection. This allows for easy querying of all matches in the tournament. Only admins can create or update matches, while all authenticated users can read them. Each match document contains a `tournamentId` to link it back to a specific tournament."
  }
}
